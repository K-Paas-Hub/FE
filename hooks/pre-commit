#!/bin/bash

# 🚀 FE 프로젝트 커밋 전 가이드라인 체크 스크립트

echo "🔍 커밋 전 개발 가이드라인 확인 중..."

# 색상 정의
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# 커밋 메시지 가져오기 (pre-commit에서는 커밋 메시지가 아직 생성되지 않음)
COMMIT_MSG=""

echo -e "${BLUE}📝 커밋 메시지:${NC}"
echo "$COMMIT_MSG"
echo ""

# 1. 커밋 메시지 형식 안내
echo -e "${YELLOW}✅ 커밋 메시지 형식 안내:${NC}"
echo "올바른 형식: <type>: <description> #<issue_number>"
echo "사용 가능한 타입: feat, fix, docs, style, refactor, test, chore"
echo "예시: feat: 새로운 기능 추가 #123"
echo ""

# 2. 변경된 파일 체크
echo -e "${YELLOW}📁 변경된 파일 체크:${NC}"
CHANGED_FILES=$(git diff --cached --name-only)

if [ -z "$CHANGED_FILES" ]; then
    echo -e "${RED}❌ 커밋할 파일이 없습니다.${NC}"
    exit 1
fi

echo "변경된 파일:"
echo "$CHANGED_FILES" | while read -r file; do
    echo "  - $file"
done
echo ""

# 3. 개발 가이드라인 요약 표시
echo -e "${YELLOW}📋 개발 가이드라인 요약:${NC}"
echo "  • 커밋 메시지: <type>: <description> #<issue_number>"
echo "  • 모든 새로운 기능은 문서화 필수"
echo "  • 테스트 가능한 코드 작성"
echo "  • 리뷰 포인트가 명확하도록 주석 추가"
echo "  • 기능별로 폴더 구조화"
echo ""

# 4. Cursor 룰 파일 존재 확인
echo -e "${YELLOW}🔍 Cursor 룰 파일 확인:${NC}"
CURSOR_RULES_DIR=".cursor/rules"
REQUIRED_RULES=(
    "fe-development-guidelines.mdc"
    "github-workflow.mdc"
    "code-quality.mdc"
    "testing-documentation.mdc"
    "development-environment.mdc"
)

MISSING_RULES=()
for rule in "${REQUIRED_RULES[@]}"; do
    if [ ! -f "$CURSOR_RULES_DIR/$rule" ]; then
        MISSING_RULES+=("$rule")
    else
        echo -e "${GREEN}✅ $rule${NC}"
    fi
done

if [ ${#MISSING_RULES[@]} -gt 0 ]; then
    echo -e "${RED}❌ 누락된 Cursor 룰 파일:${NC}"
    for rule in "${MISSING_RULES[@]}"; do
        echo "  - $rule"
    done
    echo -e "${YELLOW}⚠️  Cursor 룰 파일이 누락되었습니다. 개발 가이드라인을 확인하세요.${NC}"
fi
echo ""

# 5. 추가 체크사항 확인
echo -e "${YELLOW}🔍 추가 체크사항:${NC}"

# README 업데이트 체크
if echo "$CHANGED_FILES" | grep -q "README" && ! echo "$COMMIT_MSG" | grep -q "docs"; then
    echo -e "${YELLOW}⚠️  README가 변경되었지만 docs 타입이 아닙니다.${NC}"
fi

# 테스트 파일 체크
if echo "$COMMIT_MSG" | grep -q "feat" && ! echo "$CHANGED_FILES" | grep -q "test"; then
    echo -e "${YELLOW}⚠️  새로운 기능이지만 테스트 파일이 없습니다.${NC}"
fi

# 환경 변수 체크
if echo "$CHANGED_FILES" | grep -q "\.env" && ! echo "$COMMIT_MSG" | grep -q "env"; then
    echo -e "${YELLOW}⚠️  환경 변수 파일이 변경되었습니다.${NC}"
fi

echo ""

# 6. 최종 확인
echo -e "${GREEN}🎉 커밋 전 체크 완료!${NC}"
echo -e "${BLUE}💡 더 자세한 가이드라인은 .cursor/rules/fe-development-guidelines.mdc를 참조하세요.${NC}"
echo -e "${BLUE}📚 모든 Cursor 룰: .cursor/rules/ 디렉토리를 확인하세요.${NC}"
echo ""

exit 0
